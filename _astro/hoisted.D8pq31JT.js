const v={topSpotifySongsAndTracks:"https://mytopsongs.sahilsinghrana.workers.dev/",currentPlayerStatus:"https://mytopsongs.sahilsinghrana.workers.dev/currentPlaying"},p=new Audio;class N{static getWrapperEl(){return document.getElementById("topTracksListContainer")}static clear(){this.getWrapperEl().innerHTML=""}static addTrack(e={}){const{album:n={},name:a,external_urls:r,artists:g,preview_url:l}=e,{images:u=[]}=n,c=new D;g.forEach(d=>c.addArtist(d)),c.updateCoverArt(u,l),c.updateSongTitle(a,r?.spotify),c.apppendToDom(this.getWrapperEl())}}class D{constructor(){this.createElements()}createElements(){this.cardContainerEl=document.createElement("li"),this.cardContainerEl.className="card trackCard",this.coverArtEl=document.createElement("img"),this.songTitleEl=document.createElement("h4"),this.songTitleContainerEl=document.createElement("a"),this.metaDiv=document.createElement("div"),this.artistContainer=document.createElement("span")}addArtist(e={}){const n=!this.artistContainer.innerText;this.artistContainer.innerText=this.artistContainer.innerText.concat(n?"":", ",e.name)}updateCoverArtPreviewUrl(e){e&&(this.coverArtEl.classList.add("hasPreview"),this.coverArtEl.addEventListener("click",()=>{if(p.src===e&&!p.paused){this.coverArtEl.classList.remove("playing"),p.pause();return}p.src=e,this.coverArtEl.classList.add("playing"),p.play()}))}updateCoverArt(e=[],n){this.coverArtEl.src=e[1]?.url||e[0]?.url,this.updateCoverArtPreviewUrl(n)}updateSongTitle(e,n){this.songTitleEl.innerText=e,n&&(this.songTitleContainerEl.href=n,this.songTitleContainerEl.target="_blank")}apppendToDom(e){this.songTitleContainerEl.appendChild(this.songTitleEl),this.metaDiv.appendChild(this.songTitleContainerEl),this.metaDiv.appendChild(this.artistContainer),this.cardContainerEl.appendChild(this.coverArtEl),this.cardContainerEl.appendChild(this.metaDiv),e.appendChild(this.cardContainerEl)}}const x=document.querySelector("body > main > div > div.spotifyData > div > a.spotifyLogoContainer");function F(t=[]){const e=document.querySelector("body > main > div > div.spotifyData > div > div.topArtistsContainer > ul");e.innerHTML="",t.forEach((n={})=>{const{images:a,external_urls:r,name:g}=n,l=document.createElement("li"),u=document.createElement("img"),c=document.createElement("h4"),d=document.createElement("a");l.className="card artistCard",u.src=a[1]?.url||a[0]?.url,d.href=r?.spotify,d.target="_blank",c.innerText=g,d.appendChild(c),l.appendChild(u),l.appendChild(d),e?.appendChild(l)})}function k(t=[]){N.clear(),t.forEach((e={})=>N.addTrack(e))}fetch(v.topSpotifySongsAndTracks).then(t=>t.json()).then(t=>{const{myProfile:e,artists:n,tracks:a}=t;F(n),k(a),x.href=e?.external_urls?.spotify}).catch(t=>{console.log(t)});var y=(t=>(t.NORTHERN="Northern",t.SOUTHERN="Southern",t))(y||{}),G=(t=>(t.NEW="ðŸŒ‘",t.WAXING_CRESCENT="ðŸŒ’",t.FIRST_QUARTER="ðŸŒ“",t.WAXING_GIBBOUS="ðŸŒ”",t.FULL="ðŸŒ•",t.WANING_GIBBOUS="ðŸŒ–",t.LAST_QUARTER="ðŸŒ—",t.WANING_CRESCENT="ðŸŒ˜",t))(G||{}),U=(t=>(t.NEW="ðŸŒ‘",t.WAXING_CRESCENT="ðŸŒ˜",t.FIRST_QUARTER="ðŸŒ—",t.WAXING_GIBBOUS="ðŸŒ–",t.FULL="ðŸŒ•",t.WANING_GIBBOUS="ðŸŒ”",t.LAST_QUARTER="ðŸŒ“",t.WANING_CRESCENT="ðŸŒ’",t))(U||{}),i=(t=>(t.NEW="New",t.WAXING_CRESCENT="Waxing Crescent",t.FIRST_QUARTER="First Quarter",t.WAXING_GIBBOUS="Waxing Gibbous",t.FULL="Full",t.WANING_GIBBOUS="Waning Gibbous",t.LAST_QUARTER="Last Quarter",t.WANING_CRESCENT="Waning Crescent",t))(i||{});const A=24405875e-1,M=2.4234366115277777e6,b=27.55454988,h=29.53058770576;class m{static fromDate(e=new Date){return e.getTime()/864e5-e.getTimezoneOffset()/1440+A}static toDate(e){const n=new Date;return n.setTime((e-A+n.getTimezoneOffset()/1440)*864e5),n}}const T={hemisphere:y.NORTHERN},C=t=>(t-=Math.floor(t),t<0&&(t+=1),t);class s{static lunarAge(e=new Date){return s.lunarAgePercent(e)*h}static lunarAgePercent(e=new Date){return C((m.fromDate(e)-24515501e-1)/h)}static lunationNumber(e=new Date){return Math.round((m.fromDate(e)-M)/h)+1}static lunarDistance(e=new Date){const n=m.fromDate(e),a=s.lunarAgePercent(e)*2*Math.PI,r=2*Math.PI*C((n-24515622e-1)/b);return 60.4-3.3*Math.cos(r)-.6*Math.cos(2*a-r)-.5*Math.cos(2*a)}static lunarPhase(e=new Date,n){n={...T,...n};const a=s.lunarAge(e);return a<1.84566173161?i.NEW:a<5.53698519483?i.WAXING_CRESCENT:a<9.22830865805?i.FIRST_QUARTER:a<12.91963212127?i.WAXING_GIBBOUS:a<16.61095558449?i.FULL:a<20.30227904771?i.WANING_GIBBOUS:a<23.99360251093?i.LAST_QUARTER:a<27.68492597415?i.WANING_CRESCENT:i.NEW}static lunarPhaseEmoji(e=new Date,n){n={...T,...n};const a=s.lunarPhase(e);return s.emojiForLunarPhase(a,n)}static emojiForLunarPhase(e,n){const{hemisphere:a}={...T,...n};let r;switch(a===y.SOUTHERN?r=U:r=G,e){case i.WANING_CRESCENT:return r.WANING_CRESCENT;case i.LAST_QUARTER:return r.LAST_QUARTER;case i.WANING_GIBBOUS:return r.WANING_GIBBOUS;case i.FULL:return r.FULL;case i.WAXING_GIBBOUS:return r.WAXING_GIBBOUS;case i.FIRST_QUARTER:return r.FIRST_QUARTER;case i.WAXING_CRESCENT:return r.WAXING_CRESCENT;default:case i.NEW:return r.NEW}}static isWaxing(e=new Date){return s.lunarAge(e)<=14.765}static isWaning(e=new Date){return s.lunarAge(e)>14.765}}const W=s.lunarPhase(),O=s.isWaxing(),H=s.isWaning(),Q=s.lunarAge().toFixed(2).concat(" Days"),X=s.emojiForLunarPhase(W).concat(" ",W),V=s.lunarDistance().toFixed(2),j=s.lunarAgePercent().toFixed(2).concat("%"),q=O?"Waxing":H?"Waning":"",f=document.querySelector("#moonInfo_phase > b"),S=document.querySelector("#moonInfo_age > b"),I=document.querySelector("#moonInfo_waxWane > b"),P=document.querySelector("#moonInfo_distance > b"),w=document.querySelector("#moonInfo_agePercent > b");I&&(I.innerHTML=q);S&&(S.innerHTML=Q);P&&(P.innerHTML=V);w&&(w.innerHTML=j);f&&(f.innerHTML=X);function L(t){t&&t.classList.add("displayNone")}function R(t){t&&t.classList.remove("displayNone")}class z{static getVinylEl(){return document.getElementById("nowPlayingTrackVinyl")}static spin(){this.getVinylEl()?.classList.add("spinVinyl")}static stopSpin(){this.getVinylEl()?.classList.remove("spinVinyl")}static updateImage(e=[]){this.getVinylEl().style.backgroundImage=`url('${e[1]?.url||e[0]?.url}')`}}class ${static createArtistEl(e={}){const{name:n="",external_urls:a}=e,r=document.createElement("a");return r.innerText=n,r.href=a.spotify,r.target="_blank",r}static getContainerEl(){return document.getElementById("nowPlayingArtists")}static clear(){this.getContainerEl().innerHTML=""}static add(e={}){const n=this.getContainerEl();n.innerHTML===""||(n.innerHTML=n.innerHTML.concat(", "));const r=this.createArtistEl(e);n?.append(r)}}class J{static getEl(){return document.getElementById("nowPlayingTitle")}static setTitle(e){const n=this.getEl();n.innerHTML=e,n.target="_blank"}static setLink(e){const n=this.getEl();n.href=e,n.target="_blank"}}class o{static vinyl=z;static artists=$;static title=J;static getNotPlayingMessageWrapperEl(){return document.getElementById("notPlayingWrap")}static getNowPlayingWrapper(){return document.getElementById("nowPlayingInfo")}static hideNowPlayingWrapper(){L(this.getNowPlayingWrapper())}static hideNotPlayingWrapper(){L(this.getNotPlayingMessageWrapperEl())}static showNowPlayingWrapper(){R(this.getNowPlayingWrapper())}static showNotPlayingWrapper(){R(this.getNotPlayingMessageWrapperEl())}}async function K(){return fetch(v.currentPlayerStatus).then(t=>t.json())}function Y(t={}){const{is_playing:e,item:n={}}=t,{name:a,artists:r,external_urls:g,album:l={}}=n,{images:u}=l;if(!e){o.hideNowPlayingWrapper(),o.showNotPlayingWrapper(),o.vinyl.stopSpin();return}o.showNowPlayingWrapper(),o.hideNotPlayingWrapper(),o.title.setTitle(a),o.title.setLink(g.spotify),o.vinyl.updateImage(u),o.vinyl.spin(),o.artists.clear(),r?.forEach(c=>o.artists.add(c))}async function B(){clearTimeout(window.topSongsTimeout);try{Y(await K())}catch(t){console.error(t)}finally{window.topSongsTimeout=setTimeout(B,6e4)}}B();const E=document.getElementById("copyBtn");let _;E.addEventListener("click",()=>{const t=String(E.dataset.value||"");t&&(E.dataset.copying="true",navigator.clipboard.writeText(t),clearTimeout(_),_=setTimeout(()=>{E.dataset.copying="false"},600))});
