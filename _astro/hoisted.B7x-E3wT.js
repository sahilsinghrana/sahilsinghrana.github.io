const E=new Audio,O=document.querySelector("body > main > div > div.spotifyData > div > a.spotifyLogoContainer");function H(e=[]){const t=document.querySelector("body > main > div > div.spotifyData > div > div.topArtistsContainer > ul");t.innerHTML="",e.forEach((n={})=>{const{images:a,external_urls:r,name:p}=n,c=document.createElement("li"),u=document.createElement("img"),g=document.createElement("h4"),l=document.createElement("a");c.className="card artistCard",u.src=a[1]?.url||a[0]?.url,l.href=r?.spotify,l.target="_blank",g.innerText=p,l.appendChild(g),c.appendChild(u),c.appendChild(l),t?.appendChild(c)})}function Q(e=[]){const t=document.querySelector("body > main > div > div.spotifyData > div.topTrackAndArtistContainer > div.topTracksContainer > ul");t.innerHTML="",e.forEach((n={})=>{const{album:a={},name:r,external_urls:p,artists:c,preview_url:u}=n,{images:g=[]}=a,l=document.createElement("li"),d=document.createElement("img"),W=document.createElement("h4"),m=document.createElement("a"),y=document.createElement("div"),N=document.createElement("span");c.forEach((M,k)=>{N.innerText=N.innerText.concat(M.name,c.length-1!==k?", ":"")}),l.className="card trackCard",d.src=g[1]?.url||g[0]?.url,u&&(d.classList.add("hasPreview"),d.addEventListener("click",()=>{if(E.src===u&&!E.paused){d.classList.remove("playing"),E.pause();return}E.src=u,d.classList.add("playing"),E.play()})),m.href=p?.spotify,m.target="_blank",W.innerText=r,m.appendChild(W),y.appendChild(m),y.appendChild(N),l.appendChild(d),l.appendChild(y),t?.appendChild(l)})}fetch("https://mytopsongs.sahilsinghrana.workers.dev/").then(e=>e.json()).then(e=>{const{myProfile:t,artists:n,tracks:a}=e;H(n),Q(a),O.href=t?.external_urls?.spotify}).catch(e=>{console.log(e)});var f=(e=>(e.NORTHERN="Northern",e.SOUTHERN="Southern",e))(f||{}),D=(e=>(e.NEW="ðŸŒ‘",e.WAXING_CRESCENT="ðŸŒ’",e.FIRST_QUARTER="ðŸŒ“",e.WAXING_GIBBOUS="ðŸŒ”",e.FULL="ðŸŒ•",e.WANING_GIBBOUS="ðŸŒ–",e.LAST_QUARTER="ðŸŒ—",e.WANING_CRESCENT="ðŸŒ˜",e))(D||{}),b=(e=>(e.NEW="ðŸŒ‘",e.WAXING_CRESCENT="ðŸŒ˜",e.FIRST_QUARTER="ðŸŒ—",e.WAXING_GIBBOUS="ðŸŒ–",e.FULL="ðŸŒ•",e.WANING_GIBBOUS="ðŸŒ”",e.LAST_QUARTER="ðŸŒ“",e.WANING_CRESCENT="ðŸŒ’",e))(b||{}),i=(e=>(e.NEW="New",e.WAXING_CRESCENT="Waxing Crescent",e.FIRST_QUARTER="First Quarter",e.WAXING_GIBBOUS="Waxing Gibbous",e.FULL="Full",e.WANING_GIBBOUS="Waning Gibbous",e.LAST_QUARTER="Last Quarter",e.WANING_CRESCENT="Waning Crescent",e))(i||{});const S=24405875e-1,X=2.4234366115277777e6,q=27.55454988,T=29.53058770576;class A{static fromDate(t=new Date){return t.getTime()/864e5-t.getTimezoneOffset()/1440+S}static toDate(t){const n=new Date;return n.setTime((t-S+n.getTimezoneOffset()/1440)*864e5),n}}const I={hemisphere:f.NORTHERN},C=e=>(e-=Math.floor(e),e<0&&(e+=1),e);class s{static lunarAge(t=new Date){return s.lunarAgePercent(t)*T}static lunarAgePercent(t=new Date){return C((A.fromDate(t)-24515501e-1)/T)}static lunationNumber(t=new Date){return Math.round((A.fromDate(t)-X)/T)+1}static lunarDistance(t=new Date){const n=A.fromDate(t),a=s.lunarAgePercent(t)*2*Math.PI,r=2*Math.PI*C((n-24515622e-1)/q);return 60.4-3.3*Math.cos(r)-.6*Math.cos(2*a-r)-.5*Math.cos(2*a)}static lunarPhase(t=new Date,n){n={...I,...n};const a=s.lunarAge(t);return a<1.84566173161?i.NEW:a<5.53698519483?i.WAXING_CRESCENT:a<9.22830865805?i.FIRST_QUARTER:a<12.91963212127?i.WAXING_GIBBOUS:a<16.61095558449?i.FULL:a<20.30227904771?i.WANING_GIBBOUS:a<23.99360251093?i.LAST_QUARTER:a<27.68492597415?i.WANING_CRESCENT:i.NEW}static lunarPhaseEmoji(t=new Date,n){n={...I,...n};const a=s.lunarPhase(t);return s.emojiForLunarPhase(a,n)}static emojiForLunarPhase(t,n){const{hemisphere:a}={...I,...n};let r;switch(a===f.SOUTHERN?r=b:r=D,t){case i.WANING_CRESCENT:return r.WANING_CRESCENT;case i.LAST_QUARTER:return r.LAST_QUARTER;case i.WANING_GIBBOUS:return r.WANING_GIBBOUS;case i.FULL:return r.FULL;case i.WAXING_GIBBOUS:return r.WAXING_GIBBOUS;case i.FIRST_QUARTER:return r.FIRST_QUARTER;case i.WAXING_CRESCENT:return r.WAXING_CRESCENT;default:case i.NEW:return r.NEW}}static isWaxing(t=new Date){return s.lunarAge(t)<=14.765}static isWaning(t=new Date){return s.lunarAge(t)>14.765}}const R=s.lunarPhase(),V=s.isWaxing(),j=s.isWaning(),z=s.lunarAge().toFixed(2).concat(" Days"),$=s.emojiForLunarPhase(R).concat(" ",R),J=s.lunarDistance().toFixed(2),K=s.lunarAgePercent().toFixed(2).concat("%"),Y=V?"Waxing":j?"Waning":"",L=document.querySelector("#moonInfo_phase > b"),P=document.querySelector("#moonInfo_age > b"),w=document.querySelector("#moonInfo_waxWane > b"),_=document.querySelector("#moonInfo_distance > b"),G=document.querySelector("#moonInfo_agePercent > b");w&&(w.innerHTML=Y);P&&(P.innerHTML=z);_&&(_.innerHTML=J);G&&(G.innerHTML=K);L&&(L.innerHTML=$);const Z={topSpotifySongs:"",currentPlayerStatus:"https://mytopsongs.sahilsinghrana.workers.dev/currentPlaying"};function v(e){e&&e.classList.add("displayNone")}function U(e){e&&e.classList.remove("displayNone")}class ee{static getVinylEl(){return document.getElementById("nowPlayingTrackVinyl")}static spin(){this.getVinylEl()?.classList.add("spinVinyl")}static stopSpin(){this.getVinylEl()?.classList.remove("spinVinyl")}static updateImage(t=[]){this.getVinylEl().style.backgroundImage=`url('${t[1]?.url||t[0]?.url}')`}}class te{static createArtistEl(t={}){const{name:n="",external_urls:a}=t,r=document.createElement("a");return r.innerText=n,r.href=a.spotify,r.target="_blank",r}static getContainerEl(){return document.getElementById("nowPlayingArtists")}static clear(){this.getContainerEl().innerHTML=""}static add(t={}){const n=this.getContainerEl();n.innerHTML===""||(n.innerHTML=n.innerHTML.concat(", "));const r=this.createArtistEl(t);n?.append(r)}}class ne{static getEl(){return document.getElementById("nowPlayingTitle")}static setTitle(t){const n=this.getEl();n.innerHTML=t,n.target="_blank"}static setLink(t){const n=this.getEl();n.href=t,n.target="_blank"}}class o{static vinyl=ee;static artists=te;static title=ne;static getNotPlayingMessageWrapperEl(){return document.getElementById("notPlayingWrap")}static getNowPlayingWrapper(){return document.getElementById("nowPlayingInfo")}static hideNowPlayingWrapper(){v(this.getNowPlayingWrapper())}static hideNotPlayingWrapper(){v(this.getNotPlayingMessageWrapperEl())}static showNowPlayingWrapper(){U(this.getNowPlayingWrapper())}static showNotPlayingWrapper(){U(this.getNotPlayingMessageWrapperEl())}}async function B(){return fetch(Z.currentPlayerStatus).then(e=>e.json())}function ae(){B().then(x).catch(e=>{console.log(e)}).finally(()=>{clearInterval(window.topSongsFetchInterval),window.topSongsFetchInterval=setInterval(()=>B().then(x).catch(e=>{console.log(e)}),6e4)})}function x(e={}){const{is_playing:t,item:n={}}=e,{name:a,artists:r,external_urls:p,album:c={}}=n,{images:u}=c;if(!t){o.hideNowPlayingWrapper(),o.showNotPlayingWrapper(),o.vinyl.stopSpin();return}o.showNowPlayingWrapper(),o.hideNotPlayingWrapper(),o.title.setTitle(a),o.title.setLink(p.spotify),o.vinyl.updateImage(u),o.vinyl.spin(),o.artists.clear(),r?.forEach(g=>o.artists.add(g))}ae();const h=document.getElementById("copyBtn");let F;h.addEventListener("click",()=>{const e=String(h.dataset.value||"");e&&(h.dataset.copying="true",navigator.clipboard.writeText(e),clearTimeout(F),F=setTimeout(()=>{h.dataset.copying="false"},600))});
