const U={topSpotifySongsAndTracks:"https://mytopsongs.sahilsinghrana.workers.dev/",currentPlayerStatus:"https://mytopsongs.sahilsinghrana.workers.dev/currentPlaying"},p=new Audio;class y{static getWrapperEl(){return document.getElementById("topTracksListContainer")}static clear(){this.getWrapperEl().innerHTML=""}static addTrack(e={}){const{album:n={},name:a,external_urls:r,artists:g,preview_url:c}=e,{images:u=[]}=n,l=new x;g.forEach(d=>l.addArtist(d)),l.updateCoverArt(u,c),l.updateSongTitle(a,r?.spotify),l.apppendToDom(this.getWrapperEl())}}class x{constructor(){this.createElements()}createElements(){this.cardContainerEl=document.createElement("li"),this.cardContainerEl.className="card trackCard",this.coverArtEl=document.createElement("img"),this.songTitleEl=document.createElement("h4"),this.songTitleContainerEl=document.createElement("a"),this.metaDiv=document.createElement("div"),this.artistContainer=document.createElement("span")}addArtist(e={}){const n=!this.artistContainer.innerText;this.artistContainer.innerText=this.artistContainer.innerText.concat(n?"":", ",e.name)}updateCoverArtPreviewUrl(e){e&&(this.coverArtEl.classList.add("hasPreview"),this.coverArtEl.addEventListener("click",()=>{if(p.src===e&&!p.paused){this.coverArtEl.classList.remove("playing"),p.pause();return}p.src=e,this.coverArtEl.classList.add("playing"),p.play()}))}updateCoverArt(e=[],n){this.coverArtEl.src=e[1]?.url||e[0]?.url,this.updateCoverArtPreviewUrl(n)}updateSongTitle(e,n){this.songTitleEl.innerText=e,n&&(this.songTitleContainerEl.href=n,this.songTitleContainerEl.target="_blank")}apppendToDom(e){this.songTitleContainerEl.appendChild(this.songTitleEl),this.metaDiv.appendChild(this.songTitleContainerEl),this.metaDiv.appendChild(this.artistContainer),this.cardContainerEl.appendChild(this.coverArtEl),this.cardContainerEl.appendChild(this.metaDiv),e.appendChild(this.cardContainerEl)}}const F=document.querySelector("body > main > div > div.spotifyData > div > a.spotifyLogoContainer");function k(t=[]){const e=document.querySelector("body > main > div > div.spotifyData > div > div.topArtistsContainer > ul");e.innerHTML="",t.forEach((n={})=>{const{images:a,external_urls:r,name:g}=n,c=document.createElement("li"),u=document.createElement("img"),l=document.createElement("h4"),d=document.createElement("a");c.className="card artistCard",u.src=a[1]?.url||a[0]?.url,d.href=r?.spotify,d.target="_blank",l.innerText=g,d.appendChild(l),c.appendChild(u),c.appendChild(d),e?.appendChild(c)})}function M(t=[]){y.clear(),t.forEach((e={})=>y.addTrack(e))}fetch(U.topSpotifySongsAndTracks).then(t=>t.json()).then(t=>{const{myProfile:e,artists:n,tracks:a}=t;k(n),M(a),F.href=e?.external_urls?.spotify}).catch(t=>{console.log(t)});var N=(t=>(t.NORTHERN="Northern",t.SOUTHERN="Southern",t))(N||{}),B=(t=>(t.NEW="ðŸŒ‘",t.WAXING_CRESCENT="ðŸŒ’",t.FIRST_QUARTER="ðŸŒ“",t.WAXING_GIBBOUS="ðŸŒ”",t.FULL="ðŸŒ•",t.WANING_GIBBOUS="ðŸŒ–",t.LAST_QUARTER="ðŸŒ—",t.WANING_CRESCENT="ðŸŒ˜",t))(B||{}),D=(t=>(t.NEW="ðŸŒ‘",t.WAXING_CRESCENT="ðŸŒ˜",t.FIRST_QUARTER="ðŸŒ—",t.WAXING_GIBBOUS="ðŸŒ–",t.FULL="ðŸŒ•",t.WANING_GIBBOUS="ðŸŒ”",t.LAST_QUARTER="ðŸŒ“",t.WANING_CRESCENT="ðŸŒ’",t))(D||{}),i=(t=>(t.NEW="New",t.WAXING_CRESCENT="Waxing Crescent",t.FIRST_QUARTER="First Quarter",t.WAXING_GIBBOUS="Waxing Gibbous",t.FULL="Full",t.WANING_GIBBOUS="Waning Gibbous",t.LAST_QUARTER="Last Quarter",t.WANING_CRESCENT="Waning Crescent",t))(i||{});const A=24405875e-1,b=2.4234366115277777e6,O=27.55454988,h=29.53058770576;class m{static fromDate(e=new Date){return e.getTime()/864e5-e.getTimezoneOffset()/1440+A}static toDate(e){const n=new Date;return n.setTime((e-A+n.getTimezoneOffset()/1440)*864e5),n}}const T={hemisphere:N.NORTHERN},C=t=>(t-=Math.floor(t),t<0&&(t+=1),t);class s{static lunarAge(e=new Date){return s.lunarAgePercent(e)*h}static lunarAgePercent(e=new Date){return C((m.fromDate(e)-24515501e-1)/h)}static lunationNumber(e=new Date){return Math.round((m.fromDate(e)-b)/h)+1}static lunarDistance(e=new Date){const n=m.fromDate(e),a=s.lunarAgePercent(e)*2*Math.PI,r=2*Math.PI*C((n-24515622e-1)/O);return 60.4-3.3*Math.cos(r)-.6*Math.cos(2*a-r)-.5*Math.cos(2*a)}static lunarPhase(e=new Date,n){n={...T,...n};const a=s.lunarAge(e);return a<1.84566173161?i.NEW:a<5.53698519483?i.WAXING_CRESCENT:a<9.22830865805?i.FIRST_QUARTER:a<12.91963212127?i.WAXING_GIBBOUS:a<16.61095558449?i.FULL:a<20.30227904771?i.WANING_GIBBOUS:a<23.99360251093?i.LAST_QUARTER:a<27.68492597415?i.WANING_CRESCENT:i.NEW}static lunarPhaseEmoji(e=new Date,n){n={...T,...n};const a=s.lunarPhase(e);return s.emojiForLunarPhase(a,n)}static emojiForLunarPhase(e,n){const{hemisphere:a}={...T,...n};let r;switch(a===N.SOUTHERN?r=D:r=B,e){case i.WANING_CRESCENT:return r.WANING_CRESCENT;case i.LAST_QUARTER:return r.LAST_QUARTER;case i.WANING_GIBBOUS:return r.WANING_GIBBOUS;case i.FULL:return r.FULL;case i.WAXING_GIBBOUS:return r.WAXING_GIBBOUS;case i.FIRST_QUARTER:return r.FIRST_QUARTER;case i.WAXING_CRESCENT:return r.WAXING_CRESCENT;default:case i.NEW:return r.NEW}}static isWaxing(e=new Date){return s.lunarAge(e)<=14.765}static isWaning(e=new Date){return s.lunarAge(e)>14.765}}const I=s.lunarPhase(),H=s.isWaxing(),Q=s.isWaning(),X=s.lunarAge().toFixed(2).concat(" Days"),V=s.emojiForLunarPhase(I).concat(" ",I),j=s.lunarDistance().toFixed(2),q=s.lunarAgePercent().toFixed(2).concat("%"),z=H?"Waxing":Q?"Waning":"",W=document.querySelector("#moonInfo_phase > b"),S=document.querySelector("#moonInfo_age > b"),f=document.querySelector("#moonInfo_waxWane > b"),L=document.querySelector("#moonInfo_distance > b"),P=document.querySelector("#moonInfo_agePercent > b");f&&(f.innerHTML=z);S&&(S.innerHTML=X);L&&(L.innerHTML=j);P&&(P.innerHTML=q);W&&(W.innerHTML=V);function R(t){t&&t.classList.add("displayNone")}function w(t){t&&t.classList.remove("displayNone")}class ${static getVinylEl(){return document.getElementById("nowPlayingTrackVinyl")}static spin(){this.getVinylEl()?.classList.add("spinVinyl")}static stopSpin(){this.getVinylEl()?.classList.remove("spinVinyl")}static updateImage(e=[]){this.getVinylEl().style.backgroundImage=`url('${e[1]?.url||e[0]?.url}')`}}class J{static createArtistEl(e={}){const{name:n="",external_urls:a}=e,r=document.createElement("a");return r.innerText=n,r.href=a.spotify,r.target="_blank",r}static getContainerEl(){return document.getElementById("nowPlayingArtists")}static clear(){this.getContainerEl().innerHTML=""}static add(e={}){const n=this.getContainerEl();n.innerHTML===""||(n.innerHTML=n.innerHTML.concat(", "));const r=this.createArtistEl(e);n?.append(r)}}class K{static getEl(){return document.getElementById("nowPlayingTitle")}static setTitle(e){const n=this.getEl();n.innerHTML=e,n.target="_blank"}static setLink(e){const n=this.getEl();n.href=e,n.target="_blank"}}class o{static vinyl=$;static artists=J;static title=K;static getNotPlayingMessageWrapperEl(){return document.getElementById("notPlayingWrap")}static getNowPlayingWrapper(){return document.getElementById("nowPlayingInfo")}static hideNowPlayingWrapper(){R(this.getNowPlayingWrapper())}static hideNotPlayingWrapper(){R(this.getNotPlayingMessageWrapperEl())}static showNowPlayingWrapper(){w(this.getNowPlayingWrapper())}static showNotPlayingWrapper(){w(this.getNotPlayingMessageWrapperEl())}}async function _(){return fetch(U.currentPlayerStatus).then(t=>t.json())}_().then(v).catch(t=>{console.log(t)}).finally(()=>{clearInterval(window.topSongsFetchInterval),window.topSongsFetchInterval=setInterval(()=>_().then(v).catch(t=>{console.log(t)}),6e4)});function v(t={}){const{is_playing:e,item:n={}}=t,{name:a,artists:r,external_urls:g,album:c={}}=n,{images:u}=c;if(!e){o.hideNowPlayingWrapper(),o.showNotPlayingWrapper(),o.vinyl.stopSpin();return}o.showNowPlayingWrapper(),o.hideNotPlayingWrapper(),o.title.setTitle(a),o.title.setLink(g.spotify),o.vinyl.updateImage(u),o.vinyl.spin(),o.artists.clear(),r?.forEach(l=>o.artists.add(l))}const E=document.getElementById("copyBtn");let G;E.addEventListener("click",()=>{const t=String(E.dataset.value||"");t&&(E.dataset.copying="true",navigator.clipboard.writeText(t),clearTimeout(G),G=setTimeout(()=>{E.dataset.copying="false"},600))});
