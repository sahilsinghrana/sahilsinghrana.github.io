const g=new Audio,b=document.querySelector("body > main > div > div.spotifyData > div > a.spotifyLogoContainer");function F(e=[]){const n=document.querySelector("body > main > div > div.spotifyData > div > div.topArtistsContainer > ul");n.innerHTML="",e.forEach((a={})=>{const{images:t,external_urls:r,name:E}=a,c=document.createElement("li"),l=document.createElement("img"),m=document.createElement("h4"),i=document.createElement("a");c.className="card artistCard",l.src=t[1]?.url||t[0]?.url,i.href=r?.spotify,i.target="_blank",m.innerText=E,i.appendChild(m),c.appendChild(l),c.appendChild(i),n?.appendChild(c)})}function k(e=[]){const n=document.querySelector("body > main > div > div.spotifyData > div.topTrackAndArtistContainer > div.topTracksContainer > ul");n.innerHTML="",e.forEach((a={})=>{const{album:t={},name:r,external_urls:E,artists:c,preview_url:l}=a,{images:m=[]}=t,i=document.createElement("li"),u=document.createElement("img"),p=document.createElement("h4"),d=document.createElement("a"),T=document.createElement("div"),y=document.createElement("span");c.forEach((P,D)=>{y.innerText=y.innerText.concat(P.name,c.length-1!==D?", ":"")}),i.className="card trackCard",u.src=m[1]?.url||m[0]?.url,l&&(u.classList.add("hasPreview"),u.addEventListener("click",()=>{if(g.src===l&&!g.paused){u.classList.remove("playing"),g.pause();return}g.src=l,u.classList.add("playing"),g.play()})),d.href=E?.spotify,d.target="_blank",p.innerText=r,d.appendChild(p),T.appendChild(d),T.appendChild(y),i.appendChild(u),i.appendChild(T),n?.appendChild(i)})}fetch("https://mytopsongs.sahilsinghrana.workers.dev/").then(e=>e.json()).then(e=>{const{myProfile:n,artists:a,tracks:t}=e;F(a),k(t),b.href=n?.external_urls?.spotify}).catch(e=>{console.log(e)});var C=(e=>(e.NORTHERN="Northern",e.SOUTHERN="Southern",e))(C||{}),w=(e=>(e.NEW="ðŸŒ‘",e.WAXING_CRESCENT="ðŸŒ’",e.FIRST_QUARTER="ðŸŒ“",e.WAXING_GIBBOUS="ðŸŒ”",e.FULL="ðŸŒ•",e.WANING_GIBBOUS="ðŸŒ–",e.LAST_QUARTER="ðŸŒ—",e.WANING_CRESCENT="ðŸŒ˜",e))(w||{}),B=(e=>(e.NEW="ðŸŒ‘",e.WAXING_CRESCENT="ðŸŒ˜",e.FIRST_QUARTER="ðŸŒ—",e.WAXING_GIBBOUS="ðŸŒ–",e.FULL="ðŸŒ•",e.WANING_GIBBOUS="ðŸŒ”",e.LAST_QUARTER="ðŸŒ“",e.WANING_CRESCENT="ðŸŒ’",e))(B||{}),o=(e=>(e.NEW="New",e.WAXING_CRESCENT="Waxing Crescent",e.FIRST_QUARTER="First Quarter",e.WAXING_GIBBOUS="Waxing Gibbous",e.FULL="Full",e.WANING_GIBBOUS="Waning Gibbous",e.LAST_QUARTER="Last Quarter",e.WANING_CRESCENT="Waning Crescent",e))(o||{});const W=24405875e-1,O=2.4234366115277777e6,Q=27.55454988,N=29.53058770576;class A{static fromDate(n=new Date){return n.getTime()/864e5-n.getTimezoneOffset()/1440+W}static toDate(n){const a=new Date;return a.setTime((n-W+a.getTimezoneOffset()/1440)*864e5),a}}const I={hemisphere:C.NORTHERN},v=e=>(e-=Math.floor(e),e<0&&(e+=1),e);class s{static lunarAge(n=new Date){return s.lunarAgePercent(n)*N}static lunarAgePercent(n=new Date){return v((A.fromDate(n)-24515501e-1)/N)}static lunationNumber(n=new Date){return Math.round((A.fromDate(n)-O)/N)+1}static lunarDistance(n=new Date){const a=A.fromDate(n),t=s.lunarAgePercent(n)*2*Math.PI,r=2*Math.PI*v((a-24515622e-1)/Q);return 60.4-3.3*Math.cos(r)-.6*Math.cos(2*t-r)-.5*Math.cos(2*t)}static lunarPhase(n=new Date,a){a={...I,...a};const t=s.lunarAge(n);return t<1.84566173161?o.NEW:t<5.53698519483?o.WAXING_CRESCENT:t<9.22830865805?o.FIRST_QUARTER:t<12.91963212127?o.WAXING_GIBBOUS:t<16.61095558449?o.FULL:t<20.30227904771?o.WANING_GIBBOUS:t<23.99360251093?o.LAST_QUARTER:t<27.68492597415?o.WANING_CRESCENT:o.NEW}static lunarPhaseEmoji(n=new Date,a){a={...I,...a};const t=s.lunarPhase(n);return s.emojiForLunarPhase(t,a)}static emojiForLunarPhase(n,a){const{hemisphere:t}={...I,...a};let r;switch(t===C.SOUTHERN?r=B:r=w,n){case o.WANING_CRESCENT:return r.WANING_CRESCENT;case o.LAST_QUARTER:return r.LAST_QUARTER;case o.WANING_GIBBOUS:return r.WANING_GIBBOUS;case o.FULL:return r.FULL;case o.WAXING_GIBBOUS:return r.WAXING_GIBBOUS;case o.FIRST_QUARTER:return r.FIRST_QUARTER;case o.WAXING_CRESCENT:return r.WAXING_CRESCENT;default:case o.NEW:return r.NEW}}static isWaxing(n=new Date){return s.lunarAge(n)<=14.765}static isWaning(n=new Date){return s.lunarAge(n)>14.765}}const x=s.lunarPhase(),q=s.isWaxing(),M=s.isWaning(),X=s.lunarAge().toFixed(2),j=s.emojiForLunarPhase(x),H=s.lunarDistance().toFixed(2),V=s.lunarAgePercent().toFixed(2),z=document.getElementById("moonInfo_phase")?.querySelector("b");z.innerText=j.concat(" ",x);const $=document.getElementById("moonInfo_age")?.querySelector("b");$.innerText=X+" Days";const J=document.getElementById("moonInfo_waxWane")?.querySelector("b");J.innerText=q?"Waxing":M?"Waning":"";const K=document.getElementById("moonInfo_distance")?.querySelector("b");K.innerText=H;const Y=document.getElementById("moonInfo_agePercent")?.querySelector("b");Y.innerText=V+"%";const _=document.querySelector("body > main > div > div.spotifyData > div > div.notPlaying"),R=document.querySelector("body > main > div > div.spotifyData > div > div.nowPlayingInfo"),S=document.querySelector("#nowPlayingTitle"),L=document.querySelector("#nowPlayingArtists"),f=document.querySelector("body > main > div > div.spotifyData > div > div.trackVinyl");R?.classList.add("displayNone");function G(e={}){const{is_playing:n,item:a}=e;if(!n){_?.classList.remove("displayNone"),R?.classList.add("displayNone"),f?.classList.remove("spinVinyl");return}R?.classList.remove("displayNone"),_?.classList.add("displayNone");const{name:t,artists:r=[],external_urls:E,album:c={}}=a;S.innerHTML=t,S.href=E.spotify,S.target="_blank",L.innerHTML="";const{images:l=[]}=c;f?.classList.add("spinVinyl"),f.style.backgroundImage=`url('${l[1]?.url||l[0]?.url}')`,r.forEach((m={},i)=>{const{name:u="",external_urls:p}=m,d=document.createElement("a");d.innerText=u+(i===r.length-1?"":", "),d.href=p.spotify,d.target="_blank",L?.append(d)})}fetch("https://mytopsongs.sahilsinghrana.workers.dev/currentPlaying").then(e=>e.json()).then(G).catch(e=>{console.log(e)}).finally(()=>{clearInterval(window.topSongsFetchInterval),window.topSongsFetchInterval=setInterval(()=>fetch("https://mytopsongs.sahilsinghrana.workers.dev/currentPlaying").then(e=>e.json()).then(G).catch(e=>{console.log(e)}),6e4)});const h=document.getElementById("copyBtn");let U;h.addEventListener("click",()=>{const e=String(h.dataset.value||"");e&&(h.dataset.copying="true",navigator.clipboard.writeText(e),clearTimeout(U),U=setTimeout(()=>{h.dataset.copying="false"},600))});
